# 調査レポートPDF生成ツール（初版）

## 概要
このツールは、役所調査の結果を取りまとめて調査報告書をPDF形式で出力します。

## 機能
1. **テンプレート差し込み**
   - `Templates/報告書テンプレート.md` を読み込み
   - 変数 `{propertyTitle}`, `{sections.*}`, `{footnotes}` を置換
   - クライアント生成（ブラウザの印刷機能）でPDF出力

2. **脚注の自動集計**
   - チェック済み項目の notes に `sourceUrl|checkedAt|by` があれば脚注として収集
   - PDF末尾に「出典・取得日・担当」付録を作成

3. **対応章**
   - 物件概要
   - 都市計画
   - 道路
   - インフラ
   - 防災（ハザード）
   - 備考
   - 出典・参考情報（脚注）

## 使い方

### ローカルで使用
1. HTTPサーバーを起動
   ```bash
   cd My-Agent-Follow
   python -m http.server 8000
   ```

2. ブラウザでアクセス
   ```
   http://localhost:8000/tools/report_pdf_generator.html
   ```

3. 必要な情報を入力
   - 物件概要: 物件の基本情報
   - 各章（都市計画、道路、インフラ、防災、備考）: 調査結果を入力
   - チェック済み項目: 脚注として含めたい項目にチェック

4. レポート生成とPDF出力
   - 「📋 レポート生成」ボタンをクリックしてプレビュー表示
   - 「📥 PDF出力」ボタンをクリックしてブラウザの印刷ダイアログを開く
   - 印刷先を「PDFに保存」に設定して保存

### サンプルデータ
ツールには以下のサンプルデータが初期値として設定されています：
- 物件: 東京都渋谷区恵比寿1-2-3（サンプルマンション）
- 5つのチェック項目（用途地域、防火地域、道路台帳、上下水道、ハザードマップ）
- 各項目には出典URL、取得日、担当者の情報が含まれます

### データ構造

#### チェック済み項目の notes 形式
```json
{
  "sourceUrl": "https://www.city.shibuya.tokyo.jp/urban_planning",
  "checkedAt": "2025-01-15",
  "by": "山田太郎"
}
```

HTMLでの実装例：
```html
<input type="checkbox" checked 
  data-notes='{"sourceUrl":"https://example.com","checkedAt":"2025-01-15","by":"担当者名"}'>
```

## 技術仕様

### 使用技術
- **Pure JavaScript**: 外部ライブラリ不要
- **Browser Print API**: ブラウザ標準の印刷機能でPDF生成
- **Template Engine**: シンプルな文字列置換による変数展開

### テンプレート変数
- `{propertyTitle}`: 物件概要
- `{sections.都市計画}`: 都市計画セクション
- `{sections.道路}`: 道路セクション
- `{sections.インフラ}`: インフラセクション
- `{sections.防災}`: 防災セクション
- `{sections.備考}`: 備考セクション
- `{footnotes}`: 自動生成される脚注

### 出力形式
- ページ自動生成時に4章構成のレポートプレビューを表示
- チェック済み項目から脚注を自動集計
- ブラウザ印刷機能でPDF形式で保存可能

## DoD (Definition of Done)
✅ 4章（都市計画/道路/インフラ/ハザード）＋脚注付きPDFがダウンロード可能

## サンプル出力
生成されるPDFには以下の内容が含まれます：

```
# 調査報告書

## 物件概要
東京都渋谷区恵比寿1-2-3（サンプルマンション）

## 都市計画
用途地域: 第一種住居地域
防火地域: 準防火地域
高度地区: 第二種高度地区

## 道路
接道: 幅員6m 公道（建築基準法42条1項1号）
セットバック: 不要

## インフラ
上水道: φ200mm配管済み
下水道: 本下水接続済み
ガス: 都市ガス供給区域

## 防災
洪水ハザード: 浸水想定区域外
土砂災害: 警戒区域外
液状化リスク: 低

## 備考
特になし

## 出典・参考情報

[1] 用途地域確認
出典: https://www.city.shibuya.tokyo.jp/urban_planning
取得日: 2025-01-15
担当: 山田太郎

[2] 防火地域確認
出典: https://www.city.shibuya.tokyo.jp/fire_area
取得日: 2025-01-15
担当: 山田太郎

[3] 道路台帳確認
出典: https://www.city.shibuya.tokyo.jp/road_registry
取得日: 2025-01-16
担当: 佐藤花子

[4] 上下水道台帳確認
出典: https://www.city.shibuya.tokyo.jp/water_supply
取得日: 2025-01-16
担当: 佐藤花子

[5] ハザードマップ確認
出典: https://www.city.shibuya.tokyo.jp/hazard_map
取得日: 2025-01-17
担当: 鈴木一郎
```

## 今後の拡張予定
- jsPDF/html2canvasライブラリ統合（ローカルファイルとして）
- API連携による自動データ取得
- カスタムテンプレート対応
- 複数物件の一括出力
- 画像・図面の添付機能
